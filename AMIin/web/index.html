<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<input type='file' accept='*'/><br/>
<canvas id="canvas"></canvas>
<script>

  // await new Promise(r => setTimeout(r, 1000));
  const context = {};
  const CHUNK_SIZE = 1000000;

  function readFile(file, readIndex) {
    const reader = new FileReader();
    reader.onload = async function () {
      const view = new Int8Array(reader.result);
      context.totalSize += view.length;
      const index = readIndex / CHUNK_SIZE;
      console.log("index: " + index);
      if (readIndex < file.size) {
        readFile(file, readIndex + CHUNK_SIZE);
      } else {
        console.log("totalSize: " + context.totalSize);
      }
    };
    reader.readAsArrayBuffer(file.slice(readIndex, readIndex + CHUNK_SIZE));
  }

  document.querySelector('input').onchange = async function (event) {
    context.totalSize = 0;
    readFile(event.target.files[0], 0)
  };

</script>


</body>
</html>